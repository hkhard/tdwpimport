# Version 2.4.15 - Debug Version Instructions

## What This Version Does

Version 2.4.15 is a **debug version** specifically created to diagnose why v2.4.14 still extracts 0 players despite having logically correct code.

This version adds **comprehensive debug logging** to the `extract_players()` method in the domain mapper, tracking every step of the execution to identify exactly where and why player extraction fails.

## What Was Added

### Enhanced Debug Logging (15+ Log Points)

The `extract_players()` method now logs:

1. **Players Key Check**: Available keys if Players key is missing
2. **Wrapper Type**: The _type of the Players wrapper node
3. **Constructor Name**: For New nodes, logs the constructor name
4. **GamePlayers Detection**: Confirms when GamePlayers wrapper is found
5. **Inner Keys**: All keys inside the GamePlayers object after unwrapping
6. **Inner Players Type**: Type of the inner Players field
7. **Call Expression Details**: Object.method for Call nodes (e.g., "Map.from")
8. **Unwrap Transformation**: Before and after types when unwrapping Call expressions
9. **Array Validation**: Logs failure with actual type received if not an Array
10. **Array Item Count**: Number of items being processed
11. **Per-Item Format**: Type of each item (Array, New, or unexpected)
12. **Map.from Pair Details**: For Array items, logs count and second element type
13. **GamePlayer Detection**: Confirms when GamePlayer constructor found
14. **Extraction Success**: Logs UUID and nickname for each successfully extracted player
15. **Extraction Failure**: Logs specific reason why extraction returned null

All logs are prefixed with `v2.4.15 DEBUG:` for easy identification.

## Files Modified

1. **`includes/class-tdt-domain-mapper.php`** (lines 239-342)
   - Added comprehensive debug logging throughout `extract_players()` method

2. **`poker-tournament-import.php`** (lines 6 and 23)
   - Updated version from 2.4.14 to 2.4.15

3. **`readme.txt`** (lines 6, 78-101, 432-433)
   - Updated stable tag to 2.4.15
   - Added v2.4.15 changelog
   - Added v2.4.15 upgrade notice

## Installation .ZIP Created

**File**: `poker-tournament-import-v2.4.15.zip`

This is the complete plugin ready for installation on WordPress.

## What You Need To Do Next

### Step 1: Install v2.4.15

1. Go to WordPress Admin → Plugins
2. Deactivate "Poker Tournament Import" plugin
3. Delete the old version
4. Upload `poker-tournament-import-v2.4.15.zip`
5. Activate the plugin

### Step 2: Re-Import the Problematic File

1. Go to the import interface
2. Upload the same `ORF_Poker_20250213.tdt` file that was extracting 0 players
3. Complete the import process

### Step 3: Check Debug Logs

The debug logs will appear in your WordPress debug log (usually `wp-content/debug.log`).

Look for lines starting with:
- `v2.4.15 DEBUG:`

### Step 4: Share Debug Output

Copy all the v2.4.15 debug log lines and share them. They will reveal:
- Which code path is executing
- What types the AST nodes actually have
- Where the extraction is failing
- What the actual data structure looks like

## Expected Debug Output

The debug output should show a sequence like:

```
v2.4.15 DEBUG: Players wrapper type: New
v2.4.15 DEBUG: Constructor name: GamePlayers
v2.4.15 DEBUG: Found GamePlayers wrapper, extracting inner object
v2.4.15 DEBUG: GamePlayers inner keys: Players, ...
v2.4.15 DEBUG: Inner Players node type: Call
v2.4.15 DEBUG: Inner Players is Call: Map.from
v2.4.15 DEBUG: Unwrap: Call -> Array
v2.4.15 DEBUG: Processing 15 items from players array
v2.4.15 DEBUG: Item 0 is Array with 2 items
v2.4.15 DEBUG: Item 0 second element type: New
v2.4.15 DEBUG: Item 0 extracting GamePlayer
v2.4.15 DEBUG: Item 0 extracted player: Joakim H (116a21f0-...)
```

If any step shows unexpected values, that's where the problem is!

## Possible Failure Scenarios

Based on the debug output, we'll know if:

1. **Players key is missing** → Will show all available keys
2. **Wrapper is not GamePlayers** → Will show actual constructor name
3. **Inner Players field missing** → Will show GamePlayers inner keys
4. **Map.from not unwrapping** → Will show type before/after unwrap
5. **Not an Array after unwrap** → Will show actual type received
6. **Items are wrong format** → Will show per-item types and counts
7. **GamePlayer not detected** → Will show second element type and constructor name
8. **Extraction returning null** → Will show which player failed and why

## Why This Debug Version is Needed

The v2.4.14 code logic looks correct:
- Detects GamePlayers wrapper ✓
- Extracts inner Players field ✓
- Unwraps Map.from() ✓
- Processes [[uuid, GamePlayer], ...] pairs ✓

But empirically it still extracts 0 players. This debug version will show us **what's actually happening** vs what we expect to happen.

## After Analysis

Once you share the debug logs, I can:
1. Identify the exact failure point
2. Understand the actual AST structure
3. Implement the proper fix in v2.4.16
4. Remove debug logging and release production version

## Technical Context

### File Structure Reminder

The .tdt file has this structure:
```javascript
{
  V: "3.7.2",
  T: new Tournament({
    Players: new GamePlayers({
      Players: Map.from([
        ["116a21f0-...", new GamePlayer({UUID: "...", Nickname: "Joakim H", ...})],
        ["f482b4f0-...", new GamePlayer({UUID: "...", Nickname: "Fredrik Y", ...})],
        // 13+ more players
      ])
    })
  })
}
```

### Expected AST Structure

```
Players (field in Tournament) →
  New(GamePlayers) →
    arg: Object →
      entries: {Players: ...} →
        Players (field in GamePlayers) →
          Call(Map.from) →
            arg: Array →
              items: [
                Array(2 items) → [String(uuid), New(GamePlayer)],
                Array(2 items) → [String(uuid), New(GamePlayer)],
                ...
              ]
```

The debug logs will confirm if this is what we're actually getting!

---

**Ready for testing!** Upload the .zip, re-import the file, and share the debug logs.
